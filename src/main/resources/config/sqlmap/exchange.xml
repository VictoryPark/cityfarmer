<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cityfarmer.repository.mapper.ExchangeMapper">

	<resultMap id="boardMap" type="ExchangeBoard">
		<result column="ex_no" property="exNo"/>
		<result column="ex_title" property="exTitle"/>
		<result column="ex_content" property="exContent"/>
		<result column="ex_reg_date" property="exRegDate"/>
		<result column="ex_complete" property="exComplete"/>
		<result column="ex_view_cnt" property="exViewCnt"/>
	</resultMap>
	
	<resultMap id="fileMap" type="ExchangeFile">
		<result column="exf_no" property="exfNo"/>
		<result column="ex_no" property="exNo"/>
		<result column="exf_ori_name" property="exfOriName"/>
		<result column="exf_sys_name" property="exfSysName"/>
		<result column="exf_path" property="exfPath"/>
		<result column="exf_size" property="exfSize"/>
	</resultMap>
	
	<insert id="insertNewBoard" parameterType="ExchangeBoard">
		<selectKey keyProperty="exNo" resultType="int" order="BEFORE">
			select cf_s_exchange_no.nextval from dual
		</selectKey>
		insert into cf_exchange (
			ex_no, writer, ex_title, ex_content
		) values (
			#{exNo}, #{writer}, #{exTitle}, #{exContent} 
		)
	</insert>
	
	<insert id="insertNewFile" parameterType="ExchangeFile">
		<!-- <selectKey keyProperty="exNo" resultType="int" order="BEFORE">
			select cf_s_exchang_no.nextval from dual
		</selectKey> -->
		insert into cf_exchange_file (
			exf_no, ex_no, exf_ori_name, exf_sys_name, exf_path, exf_size
		) values (
			cf_s_exf_no.nextval, #{exNo}, #{exfOriName}, #{exfSysName}, #{exfPath}, #{exfSize}
		)
	</insert>
	
	<!-- 페이징 하려고 selectAll 하는 것 -->
	<select id="selectAllBoard" parameterType="ExchangeBoard" resultMap="boardMap">
		select *
  		from (select rownum rnum, a.* 
		  		from (  select * 
				  		  from cf_exchange
				  		order by ex_no desc) a
				where rownum &lt;= #{end})
		where rnum &gt;= #{begin}
	</select>
	
	<!-- 전체 게시물 수 -->
	<select id="selectBoardCount" resultType="int">
		select count(*)
		  from cf_exchange
	</select>
	
	<select id="selectFileByExNo" parameterType="int" resultMap="fileMap">
		select * from cf_exchange_file
			where ex_no = #{exNo}
	</select>
	
	<select id="selectBoardByExNo" parameterType="int" resultMap="boardMap">
		select * from cf_exchange
		   where ex_no = #{exNo}
	</select>
</mapper>

























