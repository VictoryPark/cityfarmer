<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cityfarmer.repository.mapper.GalleryMapper">
	
	<resultMap id="galleryMap" type="GalleryBoard">
		<result column="ga_no" property="gaNo" />
		<result column="ga_title" property="gaTitle" />
		<result column="writer" property="writer"/>
		<result column="ga_content" property="gaContent" />
		<result column="ga_rec_cnt" property="gaRecCnt" />
		<result column="ga_view_cnt" property="gaViewCnt" />
		<result column="ga_reg_date" property="gaRegDate" />
	</resultMap>
	
	<resultMap id="fileMap" type="GalleryFile">
		<result column="gaf_no" property="gafNo"/>
		<result column="ga_no" property="gaNo"/>
		<result column="gaf_ori_name" property="gafOriName"/>
		<result column="gaf_sys_name" property="gafSysName"/>
		<result column="gaf_path" property="gafPath"/>
		<result column="gaf_size" property="gafSize"/>
	</resultMap>

	<!-- 게시물 조회 -->
	<select id="selectGalleryBoard" parameterType="GalleryBoard" resultMap="galleryMap">
<!-- 		select * -->
<!-- 		  from cf_gallery -->
<!-- 		 order by ga_no desc  -->
		 select *
   		    from(select rownum rnum, a.*
   		    		from(select * 
							from cf_gallery 
							order by ga_no desc ) a  
					where rownum &lt;= #{end})
		where rnum &gt;= #{begin}
	</select>
	
	<!-- 전페 게시물의 수 -->
    <select id = "seLectGalleryBoardCount" resultType ="int">
   		    select count(*) 
			from cf_gallery    
    </select>
	
	<!-- 게시물 등록하기  -->
	<insert id="insertGalleryBoard" parameterType="GalleryBoard">
		<selectKey keyProperty="gaNo" resultType="int" order="BEFORE">
			select cf_s_gallery_no.nextval from dual
		</selectKey>
		insert into cf_gallery
		(ga_no,ga_title,writer,ga_content) 
		values(#{gaNo}, #{gaTitle},#{writer},#{gaContent})

	</insert>
	<!-- 파일 등록 -->
	<insert id="insertGalleryFile" parameterType="GalleryFile">
		insert into cf_gallery_file (
			gaf_no, ga_no, gaf_ori_name, gaf_sys_name, gaf_path, gaf_size
		) values (
			cf_s_gaf_no.nextval, #{gaNo}, #{gafOriName}, #{gafSysName}, #{gafPath}, #{gafSize}
		)
	</insert>
	
	<select id="selectFileByGaNo" parameterType="int" resultMap="fileMap">
		select * from cf_gallery_file
			where ga_no = #{gaNo}
	</select>
	
	<!-- 게시물 상세 -->
	 <select id="selectGalleryBoardByNo" parameterType="int" resultMap="galleryMap">
    	select *
    	  from cf_gallery
    	 where ga_no = #{gaNo} 
    </select>	
    
    <!-- 게시글 삭제 -->
	<delete id="GalleryDeleteBoard" parameterType="int">
		delete from cf_gallery
			  where ga_no = #{gaNo}
	</delete>

	<!-- 게시글 수정 -->
	<update id="GalleryUpdateBoard" parameterType="GalleryBoard">
    	update cf_gallery
    	   set ga_title = #{gaTitle},
    	       ga_content = #{gaContent}
    	 where ga_no = #{gaNo}
    </update>	 
 	
 	<!-- 게시글 조회수 -->
 	<update id="GalleryBoardView" parameterType="int">
    	update cf_gallery
    	   set ga_view_cnt = ga_view_cnt + 1
    	 where ga_no = #{gaNo}
    </update>	







</mapper>