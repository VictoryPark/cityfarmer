<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cityfarmer.repository.mapper.DiaryMapper">
	<resultMap id="diaryMap" type="DiaryBoard">
		<result column="dr_no" property="drNo" />
		<result column="dr_title" property="drTitle" />
		<result column="writer" property="writer" />
		<result column="dr_content" property="drContent" />
		<result column="dr_reg_date" property="drRegDate" />	
	</resultMap>
	
	<resultMap id="commentMap" type="DiaryComment" >
		<result column="dr_no" property="drNo" />
		<result column="drc_no" property="drcNo" />
		<result column="drc_writer" property="drcWriter" />
		<result column="drc_content" property="drcContent" />
		<result column="drc_reg_date" property="drcRegdate" />		
	</resultMap>
	
	<resultMap id="memberMap" type="Member">
		<result column="member_no" property="memberNo" />
		<result column="id" property="id" />
		<result column="name" property="name" />
		<result column="pass" property="pass" />
		<result column="file_path" property="filePath" />
		<result column="file_name" property="fileName" />
	</resultMap>
	
	<!-- 전체 목록 가져오기 -->
	<select id="selectDiaryBoard" parameterType="Page" resultMap="diaryMap">
		select *
		from (select rownum rnum, a.*
			from (	select *
						from cf_diary
				 	 order by dr_no desc) a
			where rownum &lt;= #{end})				 	 
		where rnum &gt;= #{begin}
	</select>
	
	<!-- 전체 게시물의 수(조건에 맞는) -->
	<select id="selectDiaryBoardCount" resultType="int">
		select count(*)
		from cf_diary
	</select>
	
	<!-- 게시물 등록하기 : insertBoard -->
	<insert id="insertDiaryBoard" parameterType="DiaryBoard">
		<!-- <selectKey keyProperty="drNo" resultType="int" order="BEFORE">
			select cf_s_diary_no.nextval.nextval from dual
		</selectKey> -->
		insert into cf_diary(
			dr_no, writer, dr_title, dr_content
		) values (
			cf_s_diary_no.nextval, #{writer}, #{drTitle}, #{drContent}
		)
	</insert> 
	
     <select id="selectDiaryBoardByNo" parameterType="int" resultMap="diaryMap">
    	select *
    	  from cf_diary
    	 where dr_no = #{drNo} 
    </select>		
    <update id="updateDiaryBoard" parameterType="DiaryBoard">
    	update cf_diary
    	   set dr_title = #{drTitle},
    	   	   dr_content = #{drContent} 	   	   
    	 where dr_no = #{drNo}
    </update>
    	   
    <delete id="deleteDiaryBoard" parameterType="int">
    	delete 
    	  from cf_diary
    	 where dr_no = #{drNo}
    </delete>
    
    <insert id="drcInsertComment" parameterType="DiaryComment">
    	<!-- <selectKey keyProperty="drcNo" resultType="int" order="BEFORE">
			select cf_s_drc_no.nextval.nextval from dual
		</selectKey> --> 
    	insert into cf_dr_comment(drc_no, dr_no, drc_writer, drc_content) values
    	(cf_s_drc_no.nextval, #{drNo}, #{drcWriter}, #{drcContent})
    </insert>
    

    <select id="drcSelectComment" parameterType="int" resultMap="commentMap">
    	select * 
    	from cf_dr_comment
    	where dr_no = #{drNo}
    	order by dr_no desc  
    </select>   
    
   
    
    <select id="selectDiaryCommentCount" resultType="int">
    	select count(*)
    	from cf_dr_comment
    	where dr_no = #{drNo}
    </select>  
      
    <update id="updateDiaryComment" parameterType="DiaryComment">
    	update cf_dr_comment
    	set drc_content = #{drcContent},
    		drc_reg_date = sysdate
    	where drc_no = #{drcNo}
    </update>
  
    <delete id="deleteDiaryComment" parameterType="int">
    	delete 
    	from cf_dr_comment
    	where drc_no = #{drcNo}
    </delete> 
</mapper>

























